# 高雄新市鎮空氣污染時空分布分析系統

Kaohsiung Air Quality Spatial-Temporal Analysis System

## 專案簡介

本系統用於分析高雄新市鎮地區的空氣污染時空分布特徵，提供多種視覺化圖表和統計分析功能。

## 功能特色

- 多年份資料整合分析（2020-2025）
- 多種時間尺度聚合（小時/日/週/月/季/年）
- 時段分析（清晨/早上尖峰/午間/傍晚尖峰/夜間/深夜）
- 多種圖表類型：
  - PM2.5 空間分布
  - 溫度空間分布
  - 濕度空間分布
  - PM2.5 變異係數
  - PM2.5 超標比例
  - 不舒適指數
  - 風場向量圖
- 圖表預覽與下載（單張/批次）
- 友善的網頁操作介面

## 系統需求

- Python 3.8 或以上版本
- 8GB RAM（建議）
- 網頁瀏覽器（Chrome/Firefox/Edge）

## 安裝步驟

### Windows 使用者

1. 確保已安裝 Python 3.8+
   - 檢查方式：開啟命令提示字元，輸入 `python --version`
   - 若未安裝，請前往 [Python 官網](https://www.python.org/downloads/) 下載安裝

2. 解壓縮專案資料夾到任意位置

3. 雙擊 `run_app.bat` 啟動系統
   - 第一次執行會自動安裝必要套件（需要幾分鐘）
   - 安裝完成後瀏覽器會自動開啟

4. 開始使用系統

### Linux/Mac 使用者

1. 確保已安裝 Python 3.8+
   ```bash
   python3 --version
   ```

2. 解壓縮專案資料夾

3. 開啟終端機，進入專案目錄
   ```bash
   cd /path/to/kaohsiung_air_quality_system
   ```

4. 給予執行權限（**只需要第一次執行**）
   ```bash
   chmod +x run_app.sh
   ```

5. 執行啟動腳本
   ```bash
   ./run_app.sh
   ```

6. 等待瀏覽器自動開啟

### 手動安裝（進階使用者）

如果自動安裝腳本無法使用，可以手動執行：

```bash
# 1. 進入專案目錄
cd /path/to/kaohsiung_air_quality_system

# 2. 安裝必要套件
pip install -r requirements.txt

# 3. 啟動系統
streamlit run app.py
```

## 使用說明

### 1. 設定分析參數

啟動系統後，在左側邊欄進行設定：

#### 資料來源
- **資料目錄**：存放年度資料檔案的資料夾路徑
  - 預設：`F:/AirBox`
- **測站檔案**：測站座標資訊檔案路徑
  - 預設：`F:/AirBox/Kaohsiung_iot_station.csv`

#### 時間範圍
- **選擇年份**：可多選 2020-2025 年的資料
- **時間聚合方式**：
  - 每小時：產生每小時的圖表
  - 每日：產生每日的圖表
  - 每週：產生每週的圖表
  - 每月：產生每月的圖表
  - 每季：產生每季的圖表
  - 每年：產生每年的圖表

#### 時段分析
- **啟用時段分析**：勾選後可選擇特定時段
  - 全時段：24 小時完整資料
  - 清晨低谷：05:00-07:00
  - 早上尖峰：07:00-09:00
  - 午間擴散：12:00-14:00
  - 傍晚尖峰：17:00-19:00
  - 夜間累積：20:00-22:00
  - 深夜低值：22:00-05:00

#### 圖表類型
可多選以下圖表：
- PM2.5 空間分布
- 溫度空間分布
- 濕度空間分布
- PM2.5 變異係數
- PM2.5 超標比例
- 不舒適指數
- 風場向量圖

#### 進階設定（選用）
- **網格解析度**：100-500（數值越高圖表越細緻，但運算時間越長）
- **擴散半徑**：0.01-0.2（影響空間插值範圍）
- **風向影響係數**：0.0-1.0（風向對污染擴散的影響程度）
- **圖片解析度**：72-300 DPI（數值越高圖片越清晰，檔案越大）
- **使用底圖**：勾選後會顯示地圖底圖（需要網路連線）

### 2. 開始分析

1. 確認所有參數設定完成
2. 點擊「開始分析」按鈕
3. 系統會顯示進度條和目前執行的步驟：
   - 步驟 1/4：讀取資料
   - 步驟 2/4：資料清理
   - 步驟 3/4：建立測站座標
   - 步驟 4/4：產生圖表
4. 分析完成後會顯示成功訊息

### 3. 預覽和下載圖表

#### 單張圖表下載
1. 在「圖表預覽與下載」區域選擇要查看的圖表
2. 系統會顯示圖表預覽
3. 點擊「下載此圖表」按鈕下載 PNG 檔案

#### 批次下載
1. 點擊「打包所有圖表為 ZIP」按鈕
2. 系統會將所有圖表打包成 ZIP 檔案
3. 點擊「下載 ZIP 檔案」按鈕下載
4. ZIP 檔案命名格式：`kaohsiung_air_quality_YYYYMMDD_HHMMSS.zip`

## 資料格式說明

### 年度資料檔案

**檔名格式**：`kaohsiung_airbox_hourly_with_wind_{年份}.csv`

範例：
- `kaohsiung_airbox_hourly_with_wind_2020.csv`
- `kaohsiung_airbox_hourly_with_wind_2021.csv`
- `kaohsiung_airbox_hourly_with_wind_2022.csv`

**必要欄位**：

| 欄位名稱 | 說明 | 單位 | 範例 |
|---------|------|------|------|
| `deviceId` | 測站編號 | - | `74DA38F208E6` |
| `timestamp` | 時間戳記 | - | `2020-01-01 00:00:00` |
| `pm25_mean` | PM2.5 平均值 | μg/m³ | `25.3` |
| `temperature_mean` | 溫度平均值 | °C | `23.5` |
| `humidity_mean` | 濕度平均值 | % | `65.2` |
| `WindSpeed_Mean` | 風速平均值 | m/s | `2.1` |
| `WindDirection_Mean` | 風向平均值 | 度 | `180.0` |

**選用欄位**：
- `pm25_std`：PM2.5 標準差
- `pm25_cv`：PM2.5 變異係數
- `pm25_exceeds_35_pct`：PM2.5 超標百分比
- `discomfort_index_mean`：不舒適指數平均值

### 測站座標檔案

**檔名**：`Kaohsiung_iot_station.csv`

**必要欄位**：

| 欄位名稱 | 說明 | 範例 |
|---------|------|------|
| `deviceId` | 測站編號 | `74DA38F208E6` |
| `lat` | 緯度（WGS84） | `22.6273` |
| `lon` | 經度（WGS84） | `120.3014` |

## 常見問題

### Q1: 啟動後瀏覽器沒有自動開啟？

**解決方式**：
1. 手動開啟瀏覽器
2. 在網址列輸入：`http://localhost:8501`
3. 按 Enter 鍵

### Q2: 出現「找不到資料檔案」錯誤？

**檢查項目**：
1. 資料目錄路徑是否正確
2. 檔案命名是否符合格式 `kaohsiung_airbox_hourly_with_wind_{年份}.csv`
3. 選擇的年份是否有對應的檔案
4. 檔案是否可以正常開啟（沒有損壞）

### Q3: 圖表產生速度很慢？

**優化建議**：
1. 降低網格解析度（調整為 100-200）
2. 減少選擇的圖表類型（一次只選 1-2 種）
3. 關閉底圖功能（取消勾選「使用底圖」）
4. 一次只分析一個年份
5. 使用較粗的時間聚合（例如選擇「每月」而非「每小時」）

### Q4: 出現記憶體不足錯誤？

**解決方式**：
1. 一次只分析一個年份
2. 降低網格解析度到 100-150
3. 關閉其他佔用記憶體的程式
4. 不要同時產生太多圖表類型

### Q5: 圖表上的中文顯示為方塊？

**解決方式**：
1. 確認系統已安裝「微軟正黑體」字型
2. Windows 使用者通常已內建，無需額外安裝
3. Linux 使用者可能需要安裝中文字型：
   ```bash
   sudo apt-get install fonts-noto-cjk
   ```

### Q6: 無法下載 ZIP 檔案？

**解決方式**：
1. 檢查瀏覽器的下載設定
2. 確認有足夠的硬碟空間
3. 嘗試關閉瀏覽器的彈出視窗封鎖
4. 改用單張下載方式

### Q7: 執行 `run_app.bat` 時閃退？

**解決方式**：
1. 以系統管理員身分執行
2. 檢查 Python 是否正確安裝
3. 手動執行安裝指令：
   ```bash
   pip install -r requirements.txt
   streamlit run app.py
   ```

### Q8: Linux/Mac 執行 `./run_app.sh` 出現「Permission denied」？

**解決方式**：
```bash
chmod +x run_app.sh
./run_app.sh
```

## 效能建議

### 建議配置（不同使用情境）

| 使用情境 | 網格解析度 | 時間聚合 | 預期時間 |
|---------|-----------|---------|---------|
| 快速預覽 | 100-150 | 每月/每年 | 1-2 分鐘 |
| 一般分析 | 200-300 | 每週/每月 | 3-5 分鐘 |
| 高品質輸出 | 300-400 | 每日 | 10-20 分鐘 |
| 最高品質 | 400-500 | 每小時 | 30+ 分鐘 |

### 記憶體使用估算

- 單一年份 + 每月聚合：約 2-3 GB
- 單一年份 + 每日聚合：約 4-6 GB
- 多年份 + 每月聚合：約 4-8 GB
- 多年份 + 每日聚合：約 8-12 GB

## 版本歷史

### v1.0 (2026-01-05)
- 初始版本發布
- 支援 2020-2025 年資料分析
- 提供 7 種圖表類型
- 支援時段分析功能
- 實作網頁操作介面
- 支援單張和批次下載

---

**最後更新**：2026-01-05  
**文件版本**：1.0